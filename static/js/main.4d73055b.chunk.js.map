{"version":3,"sources":["logic/component/Strip.js","logic/component/SequentialArtStrip.js","logic/component/StripContainer.js","index.js"],"names":["Strip","className","src","this","props","imgUrl","alt","imgAlt","React","Component","SequentialArtStrip","setState","num","page","places","String","padStart","getPageFromAnchor","console","log","document","URL","urlParts","split","from","length","parseInt","isNaN","SequentialArtStripContainer","leastFrom","ref","createRef","state","to","placeHolderCallback","oldFrom","newFrom","Math","max","current","childElementCount","oldElem","getElementsByClassName","item","oldPos","getBoundingClientRect","top","newPos","delta","documentElement","scrollTop","doc","bufferHeight","window","innerHeight","scrollHeight","clientHeight","loadMoreTo","items","Array","_","i","value","push","id","style","height","padding","onClick","loadMoreFrom","scrollLambda","f","timeout","canBeShot","hasBeenRepeated","callback","setTimeout","throttle","e","trackScrolling","anchorLambda","trackAnchor","addEventListener","prevProps","prevState","snapshot","removeEventListener","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.4d73055b.chunk.js","sourcesContent":["import React from \"react\";\r\n\r\nexport class Strip extends React.Component {\r\n    render() {\r\n        return <img className={\"strip-img\"} src={this.props.imgUrl} alt={this.props.imgAlt} />;\r\n    }\r\n}\r\n","import React from \"react\";\r\nimport {Strip} from \"./Strip\";\r\n\r\nconst zeroPad = (num, places) => String(num).padStart(places, '0')\r\n\r\nexport class SequentialArtStrip extends React.Component {\r\n    page;\r\n\r\n    updateSrc(src) {\r\n        this.setState({src: src});\r\n    }\r\n\r\n    render() {\r\n        return <Strip imgUrl={\"https://www.collectedcurios.com/SA_\"+zeroPad(this.props.page, 4)+\"_small.jpg\"} imgAlt={this.props.page}/>;\r\n    }\r\n}\r\n","import React from \"react\";\r\nimport {SequentialArtStrip} from \"./SequentialArtStrip\";\r\n\r\nconst getPageFromAnchor = function () {\r\n    console.log(document.URL);\r\n    const urlParts = document.URL.split('#');\r\n    let from = (urlParts.length > 1) ? parseInt(urlParts[1]) : 1;\r\n    if (isNaN(from)) from = 1;\r\n\r\n    return from;\r\n};\r\n\r\nfunction throttle(f, timeout) {\r\n    let canBeShot = true;\r\n    let hasBeenRepeated = false;\r\n\r\n    let callback = () => {\r\n        if (canBeShot) {\r\n            f();\r\n            canBeShot = false;\r\n            setTimeout(() => {\r\n                canBeShot = true;\r\n                if (hasBeenRepeated) {\r\n                    callback();\r\n                    hasBeenRepeated = false;\r\n                }\r\n            }, timeout);\r\n        } else {\r\n            hasBeenRepeated = true;\r\n        }\r\n    }\r\n\r\n    return callback;\r\n}\r\n\r\nfunction singeFire(f) {\r\n    let shot = false;\r\n\r\n    return () => {\r\n        if (!shot) {\r\n            f();\r\n            shot = true;\r\n        }\r\n    };\r\n}\r\n\r\nexport class SequentialArtStripContainer extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        const leastFrom = getPageFromAnchor();\r\n        this.ref = React.createRef();\r\n        this.state = {from: leastFrom, to: leastFrom + 10};\r\n        this.placeHolderCallback = () => {};\r\n    }\r\n\r\n    loadMoreFrom() {\r\n        const oldFrom = this.state.from;\r\n        const newFrom = Math.max(oldFrom - 10, 1);\r\n\r\n        this.setState({from: newFrom});\r\n        console.log(this.ref.current.childElementCount);\r\n        const oldElem = this.ref.current.getElementsByClassName(\"strip-img\").item(0);\r\n        const oldPos = oldElem.getBoundingClientRect().top;\r\n        this.placeHolderCallback = () => {\r\n            const newPos = oldElem.getBoundingClientRect().top;\r\n            const delta = newPos - oldPos;\r\n            console.log(oldPos, newPos, delta, this.ref.current.childElementCount);\r\n            document.documentElement.scrollTop += delta;\r\n        }\r\n    }\r\n\r\n    loadMoreTo() {\r\n        this.setState({to: this.state.to + 10});\r\n    }\r\n\r\n    trackAnchor() {\r\n        const from = getPageFromAnchor();\r\n        if (this.state.from !== from) {\r\n            this.setState({from: from})\r\n        }\r\n    }\r\n\r\n    trackScrolling() {\r\n        const doc = document.documentElement;\r\n\r\n        const bufferHeight = window.innerHeight;\r\n\r\n        const distToBottom = doc.scrollHeight - (doc.scrollTop + doc.clientHeight);\r\n        if (distToBottom < bufferHeight) {\r\n            this.loadMoreTo();\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const from = this.state.from;\r\n        const to = this.state.to;\r\n        const indexes = Array.from({length: to - from + 1}, (_, i) => from + i);\r\n        const items = [];\r\n\r\n        for (const value of indexes) {\r\n            items.push(<SequentialArtStrip key={value} page={value}/>)\r\n        }\r\n\r\n        return <div ref={this.ref} id={\"stripContainer\"} className={\"stripContainerDiv\"}>\r\n            <button style={{height: \"16px\", padding: \"2px\"}} onClick={() => this.loadMoreFrom()}>Загрузить еще</button>\r\n            {items}\r\n        </div>;\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.scrollLambda = throttle((e) => this.trackScrolling(), 25);\r\n        this.anchorLambda =  (e) => this.trackAnchor();\r\n        window.addEventListener(\"hashchange\", this.anchorLambda);\r\n        document.addEventListener(\"scroll\", this.scrollLambda);\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState, snapshot) {\r\n        this.placeHolderCallback();\r\n        this.placeHolderCallback = () => {};\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.removeEventListener(\"hashchange\", this.anchorLambda);\r\n        document.removeEventListener(\"scroll\", this.scrollLambda);\r\n    }\r\n}\r\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport {SequentialArtStripContainer} from \"./logic/component/StripContainer\";\n\nReactDOM.render((<SequentialArtStripContainer/>), document.getElementById('root'));\n"],"sourceRoot":""}